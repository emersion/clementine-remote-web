<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Clementine</title>

	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

	<script src="/components/webcomponentsjs/webcomponents.js"></script>
	<link rel="import" href="/components/core-toolbar/core-toolbar.html">
	<link rel="import" href="/components/core-header-panel/core-header-panel.html">
	<link rel="import" href="/components/core-icons/core-icons.html">
	<link rel="import" href="/components/core-icons/av-icons.html">
	<link rel="import" href="/components/core-icons/hardware-icons.html">
	<link rel="import" href="/components/core-pages/core-pages.html">
	<link rel="import" href="/components/core-list/core-list.html">
	<link rel="import" href="/components/core-menu/core-menu.html">
	<link rel="import" href="/components/paper-icon-button/paper-icon-button.html">
	<link rel="import" href="/components/paper-button/paper-button.html">
	<link rel="import" href="/components/paper-tabs/paper-tabs.html">
	<link rel="import" href="/components/paper-slider/paper-slider.html">
	<link rel="import" href="/components/paper-menu-button/paper-menu-button.html">
	<link rel="import" href="/components/paper-dropdown/paper-dropdown.html">
	<link rel="import" href="/components/paper-item/paper-item.html">
	<link rel="import" href="/components/paper-toast/paper-toast.html">
	<link rel="import" href="/components/paper-dialog/paper-dialog.html">
	<link rel="import" href="/components/paper-dialog/paper-action-dialog.html">
	<link rel="import" href="/components/font-roboto/roboto.html">

	<link rel="stylesheet" href="/assets/main.css"  shim-shadowdom>

	<meta name="mobile-web-app-capable" content="yes">
	<link rel="manifest" href="/manifest.json">
	<link rel="icon" href="https://github.com/clementine-player/Clementine/raw/master/data/icon.svg">

	<script src="/assets/bundle.js"></script>
</head>
<body fullbleed vertical layout unresolved>

<polymer-element name="library-album" constructor="LibraryAlbum" attributes="model">
	<template>
		<style>
.album-item {
	width: 145px;
	height: 140px;
	margin-top: 5px;
	border-bottom: 5px solid transparent;
}
.album-item .cover {
	/*background-image: url("http://ecx.images-amazon.com/images/I/71evDOB6QhL._SL1417_.jpg");*/
	background-size: cover;
	background-position: center center;
}
/* @see http://nicolasgallagher.com/css-background-image-hacks/#emulating-background-opacity */
.album-item .cover.no-cover::before {
	content: "";
	position: absolute;
	z-index: -1;
	top: 0;
	bottom: 0;
	left: 0;
	right: 0;

	background-image: url("/assets/headset.svg");
	background-size: contain;
	background-position: center center;
	background-repeat: no-repeat;
	opacity: 0.2;
}
.album-item .footer {
	background-color: #2D2D2D;
}
.album-item .footer .info {
	padding: 7px;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}
.album-item .footer .info .subtitle {
	color: gray;
}
		</style>
		<core-item class="album-item {{ {selected: selected} | tokenList }}" layout vertical>
			<paper-ripple class="cover no-cover" flex on-click="{{onClick}}"></paper-ripple>
			<div class="footer" layout horizontal>
				<div class="info" flex layout vertical on-click="{{onClick}}">
					<div class="title">{{model[0] || 'Unknown'}}</div>
					<div class="subtitle">
						<span class="artist">{{model[1]}}</span> | <span class="tracks">{{model[2]}} tracks</span>
					</div>
				</div>
				<div class="actions" horizontal layout end>
					<paper-icon-button icon="more-vert"></paper-icon-button>
				</div>
			</div>
		</core-item>
	</template>
	<script>
	Polymer('library-album', {
		onClick: function () {
			clementine.openAlbum({
				album: this.model[0],
				artist: this.model[1]
			});
		}
	});
	</script>
</polymer-element>

<polymer-element name="library-track" constructor="LibraryTrack" attributes="model">
	<template>
		<style>
.track {
	padding: 10px;
	border-bottom: 1px solid rgba(255, 255, 255, 0.15);
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}
.track.selected {
	background-color: rgba(255, 255, 255, 0.15);
}
.track .title {
	font-size: 1.1em;
}
.track .artist {
	opacity: 0.7;
}
		</style>
		<core-item label="{{model.title}}" class="track" layout horizontal>
			<div on-click="{{onClick}}" flex>
				<div class="title">{{model[0] || 'Unknown'}}</div>
				<div class="artist">{{model[2] || ''}}</div>
			</div>
			<paper-icon-button icon="more-vert"></paper-icon-button>
		</core-item>
	</template>
	<script>
	Polymer('library-track', {
		onClick: function () {
			clementine.playTrack(this.model[3]);
		}
	});
	</script>
</polymer-element>

<polymer-element name="album-page" constructor="AlbumPage" attributes="model tracks client">
	<template>
		<style>
core-toolbar {
	background-color: #db6835;
	color: white;
	background-image: url("http://ecx.images-amazon.com/images/I/71evDOB6QhL._SL1417_.jpg");
	background-size: cover;
	background-position: center center;
	height: 300px;
	-webkit-transition: 300ms all;
	-moz-transition: 300ms all;
	transition: 300ms all;
}
core-toolbar.no-cover {
	height: 128px;
	background-image: none;
}
core-toolbar.condensed {
	height: 128px;
}
paper-tabs::shadow #selectionBar {
	background-color: white;
}
		</style>
		<div fit layout vertical>
			<core-toolbar id="toolbar" class="no-cover">
				<paper-icon-button icon="arrow-back" on-click="{{goBack}}"></paper-icon-button>

				<span flex>{{model.album}}</span>

				<paper-tabs id="albumTabs" selected="{{selectedTab}}" class="bottom fit" noink>
					<paper-tab>INFOS</paper-tab>
					<paper-tab>TRACKS</paper-tab>
				</paper-tabs>
			</core-toolbar>

			<core-pages id="albumPages" selected="{{selectedTab}}" flex>
				<div>Not implemented.</div>
				<div fit>
					<core-list id="tracks" data="{{tracks}}" selectionEnabled fit>
						<template>
							<library-track class="{{ {selected: selected} | tokenList }}" model="{{model}}"></library-track>
						</template>
					</core-list>
				</div>
			</core-pages>

			<now-playing-toolbar id="playingToolbar"></now-playing-toolbar>
		</div>
	</template>
	<script>
	Polymer('album-page', {
		selectedTab: 1,
		model: { album: 'Unknown', artist: 'Unknown' },
		tracks: [],
		goBack: function () {
			clementine.goBack();
		},
		tracksChanged: function (oldValue, newValue) {
			this.$.tracks.tracks = newValue;
		},
		clientChanged: function () {
			this.$.playingToolbar.client = this.client;
		},
		ready: function () {
			var that = this;
			var readjusting = false;
			this.$.tracks.addEventListener('scroll', function (e) {
				if (readjusting) return;

				var classList = that.$.toolbar.classList;
				var changed = false;

				if (that.$.tracks.scrollTop > 0 && !classList.contains('condensed')) {
					that.$.toolbar.classList.add('condensed');
					changed = true;
				}
				if (that.$.tracks.scrollTop == 0 && classList.contains('condensed')) {
					that.$.toolbar.classList.remove('condensed');
					changed = true;
				}

				if (changed) {
					readjusting = true;
					var scrollTop = that.$.tracks.scrollTop;
					that.$.tracks.updateSize();
					that.$.tracks.scrollTop = scrollTop;
					setTimeout(function () {
						readjusting = false;
					}, 0);
				}
			});
		}
	});
	</script>
</polymer-element>

<polymer-element name="now-playing-toolbar" constructor="NowPlayingToolbar" attributes="client">
	<template>
		<style>
core-toolbar {
	width: 100%;
	color: white;
	background-color: black;
}
core-toolbar::shadow #topBar {
	padding-left: 0;
}
core-toolbar img#cover {
	height: 100%;
	margin: 0;
}
		</style>
		<core-toolbar id="nowPlaying">
			<img src="http://ecx.images-amazon.com/images/I/71evDOB6QhL._SL1417_.jpg" alt="" id="cover">
			<span id="title" flex>Rolling in the Deep</span>
			<paper-icon-button id="playBtn" icon="av:play-arrow"></paper-icon-button>
		</core-toolbar>
	</template>
	<script>
	Polymer('now-playing-toolbar', {
		ready: function () {
			this.$.playBtn.addEventListener('click', function (e) {
				clementine.client.playpause();
				e.stopPropagation();
			});
			this.$.nowPlaying.addEventListener('click', function (e) {
				clementine.openNowPlaying();
			});
		},
		clientChanged: function () {
			var that = this;
			this.client.on('song', function (song) {
				that.$.title.innerHTML = song.title;

				if (song.art) {
					var src = 'data:image/*;base64,'+song.art.toBase64();
					that.$.cover.src = src;
					that.$.cover.style.display = 'inline-block';
				} else {
					that.$.cover.style.display = 'none';
				}
			});
			this.client.on('play', function (song) {
				that.$.playBtn.icon = 'av:pause';
			});
			this.client.on('pause', function (song) {
				that.$.playBtn.icon = 'av:play-arrow';
			});
		}
	});
	</script>
</polymer-element>

<core-pages id="appPages" selected="0" fit>

<div id="pageMain" fit layout vertical>
	<core-toolbar class="medium-tall">
		<!--<paper-icon-button id="navicon" icon="menu"></paper-icon-button>-->
		<span flex>Clementine</span>
		<paper-menu-button>
			<paper-icon-button icon="more-vert"></paper-icon-button>
			<paper-dropdown class="dropdown" halign="right">
				<div class="menu">
					<paper-item>Share</paper-item>
					<paper-item>Settings</paper-item>
					<paper-item>Help</paper-item>
				</div>
			</paper-dropdown>
		</paper-menu-button>

		<paper-tabs id="mainTabs" selected="2" class="bottom fit" noink>
			<paper-tab>RECENT</paper-tab>
			<paper-tab>ARTISTS</paper-tab>
			<paper-tab>ALBUMS</paper-tab>
			<paper-tab>TRACKS</paper-tab>
		</paper-tabs>
	</core-toolbar>

	<core-pages id="mainPages" selected="2" flex>
		<div>Not implemented.</div>
		<div>Not implemented.</div>
		<div style="overflow: auto;" fit>
			<core-list id="mainAlbums" selectionEnabled fit grid width="150" height="150">
				<template>
					<library-album model="{{model}}"></library-album>
				</template>
			</core-list>
		</div>
		<div style="overflow: auto;" fit>
			<core-list id="mainTracks" selectionEnabled fit>
				<template>
					<library-track class="{{ {selected: selected} | tokenList }}" model="{{model}}"></library-track>
				</template>
			</core-list>
		</div>
	</core-pages>

	<now-playing-toolbar id="mainPlayingToolbar"></now-playing-toolbar>
</div>

<album-page id="pageAlbum" fit></album-page>

<div id="pagePlaying" fit layout vertical>
	<core-toolbar>
		<paper-icon-button id="pagePlayingBack" icon="arrow-back"></paper-icon-button>

		<span flex>Now playing</span>

		<paper-icon-button icon="favorite-outline"></paper-icon-button>
		<paper-menu-button>
			<paper-icon-button icon="more-vert"></paper-icon-button>
			<paper-dropdown class="dropdown" halign="right">
				<div class="menu">
					<paper-item>Share</paper-item>
					<paper-item>Settings</paper-item>
					<paper-item>Help</paper-item>
				</div>
			</paper-dropdown>
		</paper-menu-button>
	</core-toolbar>

	<core-toolbar id="pagePlayingTrack">
		<span flex>
			<span id="pagePlayingTitle">Rolling in the Deep</span>
			<span id="pagePlayingSubtitle" class="subtitle">Lol</span>
		</span>

		<paper-icon-button id="pagePlayingSwitch" icon="av:queue-music"></paper-icon-button>
	</core-toolbar>

	<core-pages id="pagePlayingPages" selected="0" flex>
		<div id="pagePlayingCover" fit></div>
		<div id="pagePlayingPlaylistCtn" fit>
			<core-list id="pagePlayingPlaylist" selectionEnabled fit>
				<template>
					<core-item label="{{model.title}}" class="playlist-item {{ {selected: selected} | tokenList }}" layout horizontal>
						<div flex>
							<div class="title">{{model.title}}</div>
							<div class="artist">{{model.artist || ''}}</div>
						</div>
						<paper-icon-button icon="more-vert"></paper-icon-button>
					</core-item>
				</template>
			</core-list>
		</div>
	</core-pages>

	<core-toolbar id="pagePlayingControls">
		<div vertical layout fit>
			<div><paper-slider id="pagePlayingProgress" value="0"></paper-slider></div>
			<div horizontal center-justified layout>
				<div self-center>
					<paper-icon-button id="nowPlayingPrevious" icon="av:fast-rewind"></paper-icon-button>
				</div>
				<div self-center>
					<paper-icon-button id="nowPlayingPlaypause" icon="av:play-arrow"></paper-icon-button>
				</div>
				<div self-center>
					<paper-icon-button id="nowPlayingNext" icon="av:fast-forward"></paper-icon-button>
				</div>
			</div>
		</div>

	</core-toolbar>
</div>

</core-pages>

<paper-toast id="downloadingLibraryToast" text="Loading library..." duration="9999" autoCloseDisabled></paper-toast>

<paper-action-dialog id="connectDialog" transition="core-transition-center" backdrop heading="Clementine" autoclosedisabled>
	<p>Hello</p>

	<paper-button affirmative autofocus role="button" tabindex="0">Connect</paper-button>
</paper-action-dialog>

</body>
</html>